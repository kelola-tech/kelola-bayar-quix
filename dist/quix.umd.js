(function(a){typeof define=="function"&&define.amd?define(a):a()})(function(){"use strict";class a{constructor(){this.attached=!1}get isMobile(){return window.innerWidth<568}get isVisible(){return this.iframe.style.display!="none"}get isAttached(){return this.attached}setup(){try{var i=new URL("https://kelola-bayar.vercel.app/snap/pay"),t=window.location.origin,e=function(s){for(var o,r,n=0;n<s.length;n++)(-1<(r=s[n].src).indexOf("main.js")||-1<r.indexOf("main.ts")||-1<r.indexOf("quix.js")||-1<r.indexOf("quix.min.js"))&&(o=s[n]);return o&&o.getAttribute("data-client-key")||null}(document.getElementsByTagName("script"));if(e)return this.sourceOrigin=t,this.targetOrigin=i.origin,this.clientKey=e,this.pageUrl=i+`?origin_host=${t}&digest=soon&client_key=`+e,this;throw new Error('Please add `data-client-key` attribute in the script tag <script type="text/javascript" src="...snap.js" data-client-key="CLIENT-KEY"><\/script>, Otherwise custom UI configuration will not take effect')}catch(s){throw s}}show(){if(this.isAttached)return this.iframe.style.display="block",this.iframe;console.log("iframe doesn't attached completely")}hide(){if(this.isAttached)return this.iframe.style.display="none",this.iframe;console.log("iframe doesn't attached completely")}attach(){this.isAttached||(this.iframe.name="popup_"+new Date,document.body.appendChild(this.iframe),this.attached=!this.attached)}detach(){this.isAttached&&(document.body.removeChild(this.iframe),this.attached=!this.attached)}postMessage(i){if(this.isAttached)return this.iframe.contentWindow.postMessage(i,this.targetOrigin),this}render(){try{var i=this.setup(),t=document.createElement("iframe");t.src=i.pageUrl,t.id="snap-kelar",t.style.cssText="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999999; border: 0;",["interactive","complete"].includes(document.readyState)?(this.iframe=t,this.attach()):console.log("Current document ready state is: "+document.readyState)}catch(e){console.log(e)}}}class d{constructor(){this.widget=new a}init(){this.widget.render()}pay(i,t){try{if(this.widget.isVisible)throw new Error("Snap is already open");if(!i)throw new Error("Snap Token is required");this.widget.isAttached&&(this.widget.show(),this.widget.postMessage({kelar:{data:{token:i}}}),t)&&typeof t=="object"&&window.addEventListener("message",e=>{if(e.data.hasOwnProperty("kelar")){var e=e.data.kelar,s=e.data;if(e.hasOwnProperty("status"))switch(e=e.status,s.hasOwnProperty("show")&&!s.show&&(this.widget.hide(),this.widget.detach(),this.widget.attach()),e){case"success":t.onSuccess&&t.onSuccess(s);break;case"error":t.onError&&t.onError(s);break;case"pending":t.onPending&&t.onPending(s);break;case"close":t.onClose&&t.onClose(s)}}})}catch(e){console.log(e)}}handleMessage(i){try{i.data&&i.data.hasOwnProperty("kelar")&&i.data.kelar.hasOwnProperty("show")&&!i.data.kelar.show&&this.widget.isVisible&&this.widget.hide()}catch(t){throw new Error(t)}}}window.addEventListener&&window.addEventListener("load",()=>{window.kelar=new d,window.kelar.init()})});
